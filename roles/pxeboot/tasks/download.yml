---
# download the build images
- name: DL the Ubuntu 16.04 iso file
  get_url:
    url: http://releases.ubuntu.com/16.04/ubuntu-16.04.3-server-amd64.iso
    dest: /tmp/ubuntu-16.04.3-server-amd64.iso
    mode: 0777


- name: Create directory for iso images
  file:
    path: /var/www/html/ubuntu16
    state: directory
    mode: 0755

- name: Mount the iso and copy 
  shell: mount -o loop /tmp/ubuntu-16.04.3-server-amd64.iso /mnt/

- name: Cp the mounted iso installer
  shell: cp -fr /mnt/install/netboot/* /var/lib/tftpboot/

## After the tftp copied, upload the pre-configure menu
- name: Upload Pxeboot Menu config file
  copy:
    src: syslinux.cfg
    dest: /var/lib/tftpboot/ubuntu-installer/amd64/boot-screens/
    owner: root
    group: root
    mode: 0444
    backup: yes

- name: Cp the mounted iso package to www
  shell: cp -fr /mnt/* /var/www/html/ubuntu16

## After the build been copy over, upload the ks file
- name: Upload kickstart file
  copy:
    src: ks.cfg
    dest: /var/www/html/ubuntu16
    owner: root
    group: root
    mode: 0444
    backup: yes

- name: umount the iso file
  shell: umount /mnt/
